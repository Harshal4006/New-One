<% layout("layouts/boilerplate") %>

<!--Show Listing Page Container...-->
<div class="container">
    <div class="row mt-4 justify-content-center">

        <!--Listing Title...-->
        <div class="col-12 col-md-10 col-lg-8 mb-3">
            <h3 class="fw-bold">
                <%= listing.title %>
            </h3>
        </div>

        <!--Listing Card...-->
        <div class="card col-12 col-md-10 col-lg-8 show-card listing-card overflow-hidden">

            <!--Listing Image...-->
            <img
                src="<%= listing.image.url %>"
                class="card-img-top"
                alt="Listing_Image"
            >

            <div class="card-body mt-2">

                <!--Owner Info...-->
                <p class="text-muted small mb-1">
                    Owned by <i><%= listing.owner.username %></i>
                </p>

                <!--Listing Description...-->
                <p class="mb-2">
                    <%= listing.description %>
                </p>

                <!--Listing Price...-->
                <p class="fw-bold text-danger fs-5 mb-1">
                    â‚¹ <%= listing.price ? listing.price.toLocaleString("en-IN") : "Not Available" %>
                </p>

                <!--Listing Location...-->
                <p class="text-secondary mb-0">
                    <%= listing.location %>
                </p>

                <!--Listing Country...-->
                <p class="text-secondary">
                    <%= listing.country %>
                </p>

            </div>
        </div>

        <!--Owner Actions...-->
        <% if (currUser && listing.owner._id.equals(currUser._id)) { %>
            <div class="col-12 col-md-10 col-lg-8 d-flex gap-2 mt-3">
                <a
                    href="/listings/<%= listing._id %>/edit"
                    class="btn btn-dark"
                >
                    Edit
                </a>

                <form
                    action="/listings/<%= listing._id %>?_method=DELETE"
                    method="POST"
                >
                    <button class="btn btn-dark">
                        Delete
                    </button>
                </form>
            </div>
        <% } %>

        <!--Reviews Section...-->
        <div class="col-12 col-md-10 col-lg-8 mt-1">

            <hr>

            <% if (currUser) { %>
                <!--Create Review Form...-->
                <h4 class="text-primary mb-3">
                    Leave A Review
                </h4>

                <form
                    action="/listings/<%= listing._id %>/reviews"
                    method="POST"
                >
                    <!--Rating Field...-->
                    <div class="mb-3">
                        <label class="form-label text-secondary">
                            Rating
                        </label>

                        <fieldset class="starability-slot">
                            <input type="radio" id="no-rate" class="input-no-rate" name="review[rating]" value="1" checked />
                            <input type="radio" id="rate1" name="review[rating]" value="1" />
                            <label for="rate1">1 star</label>
                            <input type="radio" id="rate2" name="review[rating]" value="2" />
                            <label for="rate2">2 stars</label>
                            <input type="radio" id="rate3" name="review[rating]" value="3" />
                            <label for="rate3">3 stars</label>
                            <input type="radio" id="rate4" name="review[rating]" value="4" />
                            <label for="rate4">4 stars</label>
                            <input type="radio" id="rate5" name="review[rating]" value="5" />
                            <label for="rate5">5 stars</label>
                        </fieldset>
                    </div>

                    <!--Comment Field...-->
                    <div class="mb-3">
                        <label class="form-label text-secondary">
                            Comment
                        </label>
                        <textarea
                            name="review[comment]"
                            class="form-control"
                            required
                        ></textarea>
                    </div>

                    <!--Submit Review Button...-->
                    <button class="btn btn-outline-dark">
                        Submit
                    </button>
                </form>

                <hr>
            <% } %>

            <!--All Reviews List...-->
            <h5 class="fw-bold mb-3">All Reviews</h5>

            <% if (listing.reviews.length === 0) { %>
                <p class="text-muted small">No reviews yet.</p>
            <% } %>

            <% for (let review of listing.reviews) { %>
                <div class="card mb-3 review-card">

                    <div class="card-body p-3">

                        <!--Review Author...-->
                        <strong class="d-block mb-1 fs-6">
                            @<%= review.author.username %>
                        </strong>

                        <!--Review Rating...-->
                        <div class="review-stars mb-2">
                            <p
                                class="starability-result"
                                data-rating="<%= review.rating %>"
                            ></p>
                        </div>

                        <!--Review Comment...-->
                        <p class="mb-2 text-secondary small">
                            <%= review.comment %>
                        </p>

                        <!--Delete Review Action...-->
                        <% if (currUser && review.author._id.equals(currUser._id)) { %>
                            <form
                                action="/listings/<%= listing._id %>/reviews/<%= review._id %>?_method=DELETE"
                                method="POST"
                                class="text-end"
                            >
                                <button class="btn btn-sm btn-outline-dark">
                                    Delete
                                </button>
                            </form>
                        <% } %>

                    </div>
                </div>
            <% } %>

        </div>
    </div>
</div>